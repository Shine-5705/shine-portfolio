---
import style from '../../assets/styles/Project.module.scss';
import { Image } from 'astro:assets';

const projects = [
    {
        id: 1,
        title: "CareMate",
        description: "AI-Powered Chronic Disease Monitoring & Remote Care system using health sensors + LLMs to generate personalized health insights",
        github: "https://github.com/Shine-5705/CareMate-AI-Powered-Chronic-Disease-Monitoring-Remote-Care",
        demo: "https://studio.youtube.com/video/BxexK93VRkA/edit",
        live: "https://caremate0507.netlify.app/",
        image: "/og-image.jpeg",
        topics: ["OpenCV", "Raspberry Pi", "Arduino", "TTS APIs", "LLMs", "Transformers", "Computer Vision", "Python", "Flask", "Docker"],
        stars: 15,
        language: "Python"
    },
    {
        id: 2,
        title: "YourLOVER – WhatsApp MCP Server",
        description: "Secure persona-driven mental health companion supporting 20+ languages.",
        github: "https://github.com/Shine-5705",
        live: "https://puch.ai/mcp/OvlqtQtqZz",
        image: "/og-image.jpeg",
        topics: ["Python 3.11", "Groq Llama 3.3 70B", "MCP", "Docker", "PostgreSQL"],
        stars: 12,
        language: "Python"
    },
    
    {
        id: 4,
        title: "AutoAttend_Gmeet",
        description: "Automation tool to auto-join Google Meet, monitor captions, detect name mentions, and sync emoji reactions in real-time using Playwright.",
        github: "https://github.com/Shine-5705/AutoAttend_Gmeet",
        demo: "https://x.com/shine_gupta17/status/1964502066472358090",
        image: "/og-image.jpeg",
        topics: ["Playwright", "Deep Learning", "Chromium", "JSON & TXT logging", "FastAPI", "Docker", "Python"],
        stars: 10,
        language: "Python"
    },
    {
        id: 5,
        title: "CSV Summarizer & Emailer",
        description: "Streamlit application to analyze CSV data, generate AI-powered summaries with Mistral, and send insights via email with PDF and CSV attachments.",
        github: "https://github.com/Shine-5705/csv-monitor-summarizer",
        demo: "https://t.co/C2XSLT3lfX",
        live: "https://csv-summarizer-emailer.onrender.com/",
        image: "/og-image.jpeg",
        topics: ["Streamlit", "Deep Learning", "Mistral API", "Gmail SMTP", "FastAPI", "Docker", "Python", "wkhtmltopdf", "Render"],
        stars: 6,
        language: "Python"
    },
    {
        id: 6,
        title: "LinkedIn Auto Connect Agent",
        description: "Selenium-powered LinkedIn automation agent with a Streamlit interface to search, filter, and auto-connect with professionals while securely managing credentials.",
        github: "https://github.com/Shine-5705/Connect_over_LinkedIN",
        demo: "https://x.com/shine_gupta17/status/1925669474767663390",
        image: "/og-image.jpeg",
        topics: ["Streamlit", "Machine Learning", "Selenium", "Docker", "Python", "GitHub", "FastAPI"],
        stars: 9,
        language: "Python"
    },
    {
        id: 7,
        title: "LinkedIn Job Automator",
        description: "Automates job applications directly on LinkedIn with custom filters (personal use; may trigger LinkedIn restrictions).",
        github: "https://github.com/Shine-5705/Autonomous_LinkedIn",
        image: "/og-image.jpeg",
        topics: ["Python", "Selenium", "Automation"],
        stars: 7,
        language: "Python"
    },
    {
        id: 3,
        title: "DRDO Chatbot",
        description: "Secure AI knowledge agent integrating FAISS + Streamlit for interactive query handling.",
        github: "https://github.com/Shine-5705/Customer_Support_Agent",
        image: "/og-image.jpeg",
        topics: ["Python", "Streamlit", "FAISS", "Docker", "LLMs"],
        stars: 8,
        language: "Python"
    },
    {
        id: 9,
        title: "India Art, Culture & Tourism Dashboard",
        description: "Data-driven Streamlit dashboard with Snowflake integration to showcase India's cultural heritage, analyze tourism patterns, and promote responsible tourism through interactive visualizations.",
        github: "https://github.com/Shine-5705/bharat-culture-tourism-analytics",
        demo: "https://studio.youtube.com/video/fsO8YhmsoQA/edit",
        live: "https://huggingface.co/spaces/Shinegupta/bharat-culture-tourism-analytics",
        image: "/og-image.jpeg",
        topics: ["Streamlit", "Machine Learning", "PyDeck", "Snowflake", "Government tourism & culture datasets", "Docker", "Python", "Git", "FastAPI"],
        stars: 14,
        language: "Python"
    },
    {
        id: 10,
        title: "Real Time Violence Detection",
        description: "Real-time violence detection system using a Vision Transformer (ViViT) model integrated with Twilio to trigger automated calls and SMS alerts when violence is detected through a live camera feed.",
        github: "https://github.com/Shine-5705/Hawkeye-surveillance",
        demo: "https://x.com/shine_gupta17/status/1925669474767663390",
        image: "/og-image.jpeg",
        topics: ["ViViT", "OpenCV", "TensorFlow", "Docker", "Python", "GitHub", "Twilio API"],
        stars: 11,
        language: "Python"
    },
    {
        id: 8,
        title: "CyberRakshak",
        description: "AI-based Cybercrime Prediction System with 82% accuracy, integrating real-time risk scoring. Winner of Innotech 2023 Award",
        github: "https://github.com/dorkydhruv/Cyber-Rakshak",
        image: "/og-image.jpeg",
        topics: ["Machine Learning", "Deep Learning", "TensorFlow", "Keras", "Flask", "Flutter", "Firebase", "Python"],
        stars: 20,
        language: "Python"
    },
    
    {
        id: 11,
        title: "PaddleOCR Fine-tuning Project",
        description: "Fine-tuned PaddleOCR on custom datasets for table detection and content recognition, improving detection and classification accuracy by 17%.",
        github: "https://github.com/Shine-5705/PaddleOCR-Finetnuing",
        image: "/og-image.jpeg",
        topics: ["PaddleOCR", "Fine-tuning", "Table Detection", "OCR", "Python", "Machine Learning"],
        stars: 5,
        language: "Python"
    }
];
---

<section id="project" class={`${style.projectsContainer} projects-container`}>
    <div class={style.floatingElements}>
        <div class={`${style.floatingIcon} floating-icon-1`} data-icon-id="1">
            <svg viewBox="0 0 128 128">
                <path fill="#FFD845" d="M40 68V57.921C40 50.948 46.218 45 53.383 45h21.102C80.359 45 84 39.96 84 34.062V13.945c0-5.726-4.306-10.026-10.04-10.981a62.801 62.801 0 00-10.743-.862c-3.611.017-7.339.324-10.374.862C43.902 4.542 42 7.848 42 13.945V22h21v3H34.891c-6.14 0-11.516 3.53-13.198 10.552-1.939 8.047-2.025 13.202 0 21.605C23.195 63.411 26.782 68 32.921 68H40z"></path>
            </svg>
        </div>
        <div class={`${style.floatingIcon} floating-icon-2`} data-icon-id="2">
            <svg viewBox="0 0 128 128">
                <path d="M128 128H0V0h128v128z" style="fill:#d00000"></path>
                <path d="M34.1 99.3c0 .1.1.2.1.3l2.2 2.2c.1.1.2.1.3.1h7.5c.1 0 .2-.1.3-.1l2.2-2.2c.1-.1.1-.2.1-.3V75.5c0-.1.1-.2.1-.3l9.5-9.1c.1-.1.2-.1.2 0l24.1 35.6c.1.1.2.1.3.1h10.6c.1 0 .2-.1.3-.2l1.9-3.7v-.3L65.7 56.9c-.1-.1 0-.2 0-.3l25.9-25.8c.1-.1.1-.2.1-.3V30c0-.1 0-.2-.1-.3l-1.5-3.4c0-.1-.1-.2-.2-.2H79.4c-.1 0-.2.1-.3.1L47 58.5c-.1.1-.1 0-.1-.1V28.9c0-.1-.1-.2-.1-.3l-2.2-2.3c-.1-.1-.2-.1-.3-.1h-7.6c-.1 0-.2.1-.3.1l-2.2 2.4c-.1.1-.1.2-.1.3v70.3z" style="fill:#fff"></path>
            </svg>
        </div>
        <div class={`${style.floatingIcon} floating-icon-3`} data-icon-id="3">
            <svg viewBox="0 0 128 128">
                <path d="m61.55 128-21.84-12.68V40.55L6.81 59.56l.08-28.32L61.55 0zM66.46 0v128l21.84-12.68V79.31l16.49 9.53-.1-24.63-16.39-9.36v-14.3l32.89 19.01-.08-28.32z" fill="#ff6f00"></path>
            </svg>
        </div>
        <div class={`${style.floatingIcon} floating-icon-4`} data-icon-id="4">
            <svg viewBox="0 0 128 128">
                <path d="M112.871 66.602c9.004 5.277 15.055 15.027 15.074 26.191.032 16.805-13.617 30.453-30.48 30.48-16.863.032-30.559-13.57-30.59-30.375-.02-11.164 5.996-20.933 14.984-26.246l8.774 14.778c.219.37.094.847-.262 1.09-3.32 2.25-5.496 6.046-5.488 10.347.012 6.895 5.633 12.477 12.55 12.461 6.919-.012 12.516-5.61 12.504-12.504-.007-4.3-2.195-8.09-5.523-10.328-.355-.242-.484-.719-.266-1.09zm0 0" fill="#128dff"></path>
            </svg>
        </div>
        <div class={`${style.floatingIcon} floating-icon-5`} data-icon-id="5">
            <svg viewBox="0 0 128 128">
                <path fill="#fff" d="M63.975 125.09c-16.317 0-31.658-6.355-43.197-17.893S2.885 80.318 2.885 64 9.24 32.341 20.778 20.803 47.657 2.91 63.975 2.91s31.659 6.355 43.198 17.893S125.065 47.682 125.065 64s-6.355 31.659-17.893 43.198-26.879 17.892-43.197 17.892z"></path>
            </svg>
        </div>
    </div>

    <div class={style.projectsContent}>
        <div class={style.sectionHeader}>
            <span class={`${style.sectionTag} section-tag`}>Featured Work</span>
            <h2 class={`${style.sectionTitle} section-title`}>My Projects</h2>
            <div class={`${style.titleUnderline} title-underline`}></div>
        </div>

        <div class={`${style.marqueeWrapper} projects-marquee`}>
            <div class={`${style.marqueeContent} marquee-content`}>
                {projects.concat(projects).map((project, index) => (
                    <div class={`${style.projectCard} project-card`}>
                        <div class={style.cardInner}>
                            <div class={`${style.cardFront} card-front`}>
                                <div class={style.projectImage}>
                                    <Image
                                        src={project.image}
                                        alt={project.title}
                                        width={350}
                                        height={315}
                                        format="webp"
                                        quality={80}
                                    />
                                    <div class={style.imageOverlay}></div>
                                </div>
                                <div class={style.projectInfo}>
                                    <div class={style.projectHeader}>
                                        <h3 class={style.projectTitle}>{project.title}</h3>
                                        <div class={style.projectStats}>
                                            <span class={style.stars}>⭐ {project.stars}</span>
                                            {project.language && (
                                                <span class={style.language}>{project.language}</span>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class={`${style.cardBack} card-back`}>
                                <div class={style.projectDetails}>
                                    <div class={style.projectHeader}>
                                        <h3 class={style.backTitle}>{project.title}</h3>
                                    </div>

                                    <div class={style.projectContent}>
                                        <p class={style.description}>{project.description}</p>

                                        {project.topics.length > 0 && (
                                            <div class={style.topicTags}>
                                                {project.topics.slice(0, 4).map((topic: string) => (
                                                    <span class={style.topicTag}>{topic}</span>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    <div class={style.projectMeta}>
                                        <div class={style.projectActions}>
                                            <a
                                                href={project.github}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                class={style.githubLink}
                                            >
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                                                </svg>
                                                GitHub
                                            </a>
                                            {project.live && (
                                                <a
                                                    href={project.live}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                    class={style.liveLink}
                                                >
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                        <path d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z"/>
                                                    </svg>
                                                    Live Demo
                                                </a>
                                            )}
                                            {project.demo && (
                                                <a
                                                    href={project.demo}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                    class={style.demoLink}
                                                >
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                        <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
                                                    </svg>
                                                    Demo
                                                </a>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    </div>
</section>

<script>
    import { gsap } from 'gsap';
    import { ScrollTrigger } from 'gsap/ScrollTrigger';
    import { createAnimations } from '../../lib/WASMAnimations';

    gsap.registerPlugin(ScrollTrigger);

    document.addEventListener('DOMContentLoaded', async () => {
        const animations = await createAnimations();
        const marquee = document.querySelector('.projects-marquee') as HTMLElement;
        const cards = document.querySelectorAll('.project-card');
        const floatingIcons = document.querySelectorAll('[data-icon-id]') as NodeListOf<HTMLElement>;

        floatingIcons.forEach((icon, index) => {
            const iconId = parseInt(icon.dataset.iconId || '0');
            animations.addIcon(icon, iconId);

            const positions = [
                { x: '15%', y: '20%' },   // top-left area
                { x: '85%', y: '25%' },   // top-right area  
                { x: '10%', y: '50%' },   // middle-left
                { x: '90%', y: '45%' },   // middle-right
                { x: '50%', y: '75%' }    // bottom-center
            ];

            const position = positions[index] || positions[0];
            
            const randomX = (Math.random() - 0.5) * 20; // ±10% variation
            const randomY = (Math.random() - 0.5) * 20; // ±10% variation

            gsap.set(icon, {
                left: `calc(${position.x} + ${randomX}%)`,
                top: `calc(${position.y} + ${randomY}%)`,
                position: 'absolute',
                rotation: Math.random() * 360,
                scale: 0.6 + Math.random() * 0.4
            });
        });

        animations.start();

        window.addEventListener('resize', () => {
            animations.handleResize();
        });

        ScrollTrigger.create({
            trigger: '.projects-container',
            start: 'top bottom',
            end: 'bottom top',
            onUpdate: (self) => {
                animations.handleScroll(self.progress);
            }
        });

        const marqueeAnimation = gsap.to('.marquee-content', {
            x: '-50%',
            duration: 40,
            ease: 'none',
            repeat: -1
        });

        let isScrolling = false;
        let scrollTimeout: number | undefined;
        let isDragging = false;
        let startX = 0;
        let dragStartPos = 0;

        // Get the actual width of the marquee content for proper infinite scroll
        const getMarqueeWidth = () => {
            const marqueeContent = document.querySelector('.marquee-content') as HTMLElement;
            return marqueeContent ? marqueeContent.scrollWidth / 2 : window.innerWidth; // Divide by 2 because content is duplicated
        };

        // Function to normalize position for infinite scroll
        const normalizePosition = (x: number) => {
            const marqueeWidth = getMarqueeWidth();
            // Keep the position within one full cycle (0 to -marqueeWidth)
            while (x > 0) x -= marqueeWidth;
            while (x < -marqueeWidth) x += marqueeWidth;
            return x;
        };

        marquee?.addEventListener('wheel', (e) => {
            e.preventDefault();

            if (!isScrolling) {
                marqueeAnimation.pause();
                isScrolling = true;
            }

            if (scrollTimeout) clearTimeout(scrollTimeout);

            const currentX = gsap.getProperty('.marquee-content', 'x') as number;
            let newX = currentX - (e.deltaY * 2);
            
            // Normalize position for infinite scroll
            newX = normalizePosition(newX);

            gsap.set('.marquee-content', { x: newX });

            scrollTimeout = window.setTimeout(() => {
                isScrolling = false;
                // Update animation progress based on normalized position
                const marqueeWidth = getMarqueeWidth();
                const progress = Math.abs(newX) / marqueeWidth;
                marqueeAnimation.progress(progress);
                marqueeAnimation.resume();
            }, 150);
        });

        marquee?.addEventListener('mousedown', (e) => {
            e.preventDefault();
            startX = e.clientX;
            dragStartPos = gsap.getProperty('.marquee-content', 'x') as number;
            marqueeAnimation.pause();
            isDragging = true;
            if (marquee) marquee.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();

            const deltaX = e.clientX - startX;
            let newX = dragStartPos + deltaX;
            
            // Normalize position for infinite scroll
            newX = normalizePosition(newX);

            gsap.set('.marquee-content', { x: newX });
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                if (marquee) marquee.style.cursor = 'grab';
                
                const currentPos = gsap.getProperty('.marquee-content', 'x') as number;
                const normalizedPos = normalizePosition(currentPos);
                
                // Update animation progress based on normalized position
                const marqueeWidth = getMarqueeWidth();
                const progress = Math.abs(normalizedPos) / marqueeWidth;
                marqueeAnimation.progress(progress);
                
                window.setTimeout(() => {
                    if (!isScrolling && !isDragging) {
                        marqueeAnimation.resume();
                    }
                }, 100);
            }
        });

        marquee?.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            dragStartPos = gsap.getProperty('.marquee-content', 'x') as number;
            marqueeAnimation.pause();
            isDragging = true;
        });

        marquee?.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            e.preventDefault();

            const deltaX = e.touches[0].clientX - startX;
            let newX = dragStartPos + deltaX;
            
            // Normalize position for infinite scroll
            newX = normalizePosition(newX);

            gsap.set('.marquee-content', { x: newX });
        });

        marquee?.addEventListener('touchend', () => {
            isDragging = false;
            
            const currentPos = gsap.getProperty('.marquee-content', 'x') as number;
            const normalizedPos = normalizePosition(currentPos);
            
            // Update animation progress based on normalized position
            const marqueeWidth = getMarqueeWidth();
            const progress = Math.abs(normalizedPos) / marqueeWidth;
            marqueeAnimation.progress(progress);
            
            window.setTimeout(() => {
                if (!isScrolling && !isDragging) {
                    marqueeAnimation.resume();
                }
            }, 100);
        });

        marquee?.addEventListener('mouseenter', () => {
            if (!isDragging && !isScrolling) {
                marqueeAnimation.pause();
            }
            gsap.to('.marquee-content', { scale: 1.02, duration: 0.3, ease: 'power2.out' });
        });

        marquee?.addEventListener('mouseleave', () => {
            if (!isDragging && !isScrolling) {
                marqueeAnimation.resume();
            }
            gsap.to('.marquee-content', { scale: 1, duration: 0.3, ease: 'power2.out' });
        });

        cards.forEach(card => {
            const front = card.querySelector('.card-front') as HTMLElement;
            const back = card.querySelector('.card-back') as HTMLElement;

            gsap.set(back, { rotationY: 180 });

            card.addEventListener('mouseenter', () => {
                gsap.to(front, { rotationY: -180, duration: 0.6, ease: 'power2.inOut' });
                gsap.to(back, { rotationY: 0, duration: 0.6, ease: 'power2.inOut' });
            });

            card.addEventListener('mouseleave', () => {
                gsap.to(front, { rotationY: 0, duration: 0.6, ease: 'power2.inOut' });
                gsap.to(back, { rotationY: 180, duration: 0.6, ease: 'power2.inOut' });
            });
        });

        gsap.timeline({
            scrollTrigger: {
                trigger: '.projects-container',
                start: 'top 80%',
                toggleActions: 'play none none reverse'
            }
        })
        .fromTo('.section-tag', { y: 30, opacity: 0 }, { duration: 0.8, y: 0, opacity: 1, ease: 'power3.out' })
        .fromTo('.section-title', { y: 50, opacity: 0 }, { duration: 1, y: 0, opacity: 1, ease: 'power3.out' }, '-=0.6')
        .fromTo('.title-underline', { scaleX: 0 }, { duration: 1, scaleX: 1, ease: 'power3.out' }, '-=0.4');
    });
</script>